# NALT Protocol v1.2.0 Specification

**Status**: Stable - 2025-07-23
**Version**: 1.2.0
**Repository**: `https://github.com/narukijima/nalt-protocol`
**License**: MIT

## Table of Contents
1.  [Overview and Design Philosophy](#1-overview-and-design-philosophy)
2.  [Basic Structure and Top-Level Object](#2-basic-structure-and-top-level-object)
3.  [`meta` Object](#3-meta-object)
4.  [`entries` and Entry Object](#4-entries-and-entry-object)
5.  [Primary Field Definitions](#5-primary-field-definitions)
6.  [Segmentation Rules](#6-segmentation-rules)
7.  [Extension Policy](#7-extension-policy)
8.  [Validation](#8-validation)
9.  [Complete JSON Example](#9-complete-json-example)
10. [Migration from v1.1.1](#10-migration-from-v111)
11. [Changelog](#11-changelog)

---

## 1. Overview and Design Philosophy

**NALT Protocol** is an open JSON specification for structuring and preserving essential personal information—such as personality, values, thoughts, and behavioral patterns—from all data generated by individuals in an AI-interpretable format.

This specification aims to accurately capture, reproduce, and extend "what makes someone who they are" in future advanced AI environments. Its design is based on four core principles:

* **Reproducibility**: Provides deterministic rules and controlled vocabularies to ensure data is interpreted consistently across different environments.
* **Contextuality**: Views events and thoughts not as isolated "points" but as graphs connected by "lines" with causal relationships and associations, preserving context.
* **Extensibility**: Provides mechanisms to safely extend the specification while maintaining backward compatibility for future needs.
* **Privacy**: Recommends structures that separate personally identifiable information from content itself, respecting data owner control.

## 2. Basic Structure and Top-Level Object

* Files MUST use **UTF-8** encoding.
* File extension is `.json`.
* Root element is a single JSON object.

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `spec_version` | string | ✔︎ | Specification name and semantic version combined. Example: `"nalt-protocol/1.2.0"` |
| `document_id` | string | ✔︎ | A globally unique ID (UUIDv4) for this JSON document. |
| `date` | string | ✔︎ | The date entries belong to (`YYYY-MM-DD` format). |
| `meta` | object | ✔︎ | Stores processing context and metadata for the entire document. |
| `entries` | array | ✔︎ | An array containing one or more Entry objects. |

### Breaking Changes from v1.1.1
- Removed `signature` field from top-level object
- Removed `x_utc_offset_minutes` from meta object
- Removed `summary`, `moods`, `tags`, `entities`, `end_date`, `created_at` fields from entries
- Removed `x_relations`, `x_due_date` extension fields
- Focus on slim-core specification with only essential fields

## 3. `meta` Object

Defines the context for the entire document.

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `language` | string | ✔︎ | Default language for the document. Specified as ISO 639-1 code. Example: `"en"` |
| `timezone` | string | ✔︎ | Specified as IANA timezone database name. Example: `"America/New_York"` |
| `x_*` | any | Optional | Free extension data with `x_` prefix. |

### Changes in v1.2.0
- Removed `x_utc_offset_minutes` field as part of slim-core initiative

## 4. `entries` and Entry Object

Represents each fragment (events, tasks, thoughts, etc.) of the diary.

**4.1 Core Fields**

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `entry_id` | string | ✔︎ | Unique ID for each Entry (UUIDv4 recommended). Serves as a key when referenced by other Entries. |
| `type` | string | ✔︎ | The type of content this Entry represents. Allowed values defined in [Section 5.1](#51-type-allowed-values). |
| `mode` | string | ✔︎ | Time of day when the event occurred. Allowed values defined in [Section 5.2](#52-mode-allowed-values-and-time-periods). |
| `content_format` | string | ✔︎ | Format of the `content` field. Allowed values defined in [Section 5.3](#53-content_format-allowed-values). |
| `content` | string | ✔︎ | Original text data entered by the user. |

### Breaking Changes from v1.0.0
- `content_format` now restricted to standard MIME types (see Section 5.4)

### Changes in v1.2.0
- Removed all recommended and optional fields to focus on core functionality
- Extension fields (`x_*`) can still be used for custom needs

**4.2 Optional Extension Fields (`x_` prefix)**

| Field Name | Type | Description |
| :--- | :--- | :--- |
| `x_*` | any | Freely definable extension data with `x_` prefix. |

## 5. Primary Field Definitions

**5.1 `type` Allowed Values**

| Value | Description |
| :--- | :--- |
| `event` | Concrete occurrences or actions that happened in the real world or were experienced by the user. |
| `reflection` | Introspection, contemplation, impressions, self-analysis, and other subjective thoughts or emotions of the user. |
| `task` | Concrete tasks to be executed such as to-do lists or reminders. |
| `idea` | Ideas, inspirations, creative concepts. |
| `log` | Monotonous records of specific data such as meals, sleep, reading. |

**5.2 `mode` Allowed Values and Time Periods**

The `mode` field indicates the time period when the event or situation described in the entry occurred.

The following five fixed values are used:

| Value | Local Time Range | Description |
| :--- | :--- | :--- |
| `morning` | 05:00 – 11:59 | Morning events |
| `afternoon` | 12:00 – 17:59 | Afternoon events |
| `evening` | 18:00 – 21:59 | Evening events |
| `night` | 22:00 – 04:59 | Night events |
| `none` | - | When time period cannot be determined or for all-day events |

- `mode` is required for each entry.
- The timezone specified in `meta.timezone` is used for local time.

**5.3 `content_format` Allowed Values**

| Value | Description |
| :--- | :--- |
| `text/plain` | Plain text without formatting |
| `text/markdown` | Markdown-formatted text |
| `text/html` | HTML-formatted text |
| `application/json` | JSON structured data |
| `text/org` | Org-mode formatted text |

### Breaking Changes from v1.0.0
- Must use standard MIME types (e.g., `text/plain` instead of `plain_text`)
- Limited to the five types listed above

## 6. Segmentation Rules

To maintain consistency in implementation, the following entry segmentation rules are strongly recommended:

1.  **Time Period Change**: Segment when `mode` changes.
2.  **Clear Topic Change**: Segment when the topic changes significantly.
3.  **`type` Change**: Segment when the role of the entry changes, such as switching from `event` to `reflection`.
4.  **Character Count**: Consider segmentation when an entry's `content` exceeds approximately 400 characters in Japanese or 240 tokens in English.

## 7. Extension Policy

### 7.1 Core Extension Rules

1.  **Unknown Field Handling**: Parsers MUST ignore any fields not defined in the official schema.
2.  **Extension Field Naming**: All custom/extension fields MUST be prefixed with `x_` to distinguish them from official fields.
3.  **Schema Flexibility**: The official JSON Schema maintains `additionalProperties: true` at all object levels to allow flexible extensions.

### 7.2 Extension Field Guidelines

- Extension fields can be added at any object level (document, meta, entry)
- Extension field names MUST follow the pattern: `x_[lowercase_snake_case]`
- Examples of valid extension fields:
  - `x_ai_metadata`
  - `x_custom_category`
  - `x_processing_hints`

### 7.3 Implementation Requirements

- Validators MUST NOT fail when encountering unknown fields
- Parsers MUST preserve extension fields during read/write operations
- Applications SHOULD document their custom extension fields for interoperability

## 8. Validation

* **Official Schema**: `https://nalt-protocol.org/schemas/v1.2.0/schema.json`
* **Validation Command Example**: `jsonschema -i [your-file.json] https://nalt-protocol.org/schemas/v1.2.0/schema.json`

## 9. Complete JSON Example

```json
{
  "spec_version": "nalt-protocol/1.2.0",
  "document_id": "550e8400-e29b-41d4-a716-446655440000",
  "date": "2025-07-10",
  "meta": {
    "language": "en",
    "timezone": "America/New_York"
  },
  "entries": [
    {
      "entry_id": "e1f2g3h4-a1b2-4c3d-8e9f-a0b1c2d3e4f5",
      "type": "reflection",
      "mode": "morning",
      "content_format": "text/plain",
      "content": "Today's economics class was complex, but I managed to understand it. I'm a bit worried about next week's report."
    },
    {
      "entry_id": "f5g6h7i8-b2c3-4d4e-9f0a-b1c2d3e4f5g6",
      "type": "task",
      "mode": "morning",
      "content_format": "text/plain",
      "content": "Economics report assignment (due Friday)"
    },
    {
      "entry_id": "a7b8c9d0-e1f2-4g3h-4i5j-k6l7m8n9o0p1",
      "type": "event",
      "mode": "afternoon",
      "content_format": "text/markdown",
      "content": "Week-long conference in **San Francisco** starting today. Excited to meet industry leaders and learn about latest AI developments."
    }
  ]
}
```

## 10. Migration from v1.1.1

For detailed migration instructions, see [Migration Guide](../docs/migration/v1.1.1_to_v1.2.0.md).

### Key Changes:
1. **Removed non-core fields**: All fields not essential to the core diary structure have been removed
2. **Slim-core focus**: Only the minimal required fields for diary entries remain
3. **Extension support**: Custom fields can still be added with `x_` prefix

### Removed Fields:
- Top-level: `signature`
- Meta: `x_utc_offset_minutes`
- Entry: `summary`, `moods`, `tags`, `entities`, `end_date`, `created_at`
- Extensions: `x_relations`, `x_due_date`

## 11. Changelog

| Version | Date | Changes |
| :--- | :--- | :--- |
| 1.2.0 | 2025-07-23 | Slim-core release: removed all non-essential fields including `signature`, `summary`, `moods`, `tags`, `entities`, `end_date`, `created_at`, `x_relations`, `x_due_date`, and `x_utc_offset_minutes` |
| 1.1.1 | 2025-07-21 | Removed top-level `timestamp`, clarified `mode` definition, added optional `created_at` for entries |
| 1.1.0 | 2025-07-10 | Added required `document_id`, MIME type restrictions for `content_format`, `end_date` field, digital signatures, UTC offset, mood intensity precision, mood type enumeration |
| 1.0.0 | 2025-07-09 | Initial Public Release |