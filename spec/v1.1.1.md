# NALT Protocol v1.1.1 Specification

**Status**: Stable - 2025-07-21
**Version**: 1.1.1
**Repository**: `https://github.com/narukijima/nalt-protocol`
**License**: MIT

## Table of Contents
1.  [Overview and Design Philosophy](#1-overview-and-design-philosophy)
2.  [Basic Structure and Top-Level Object](#2-basic-structure-and-top-level-object)
3.  [`meta` Object](#3-meta-object)
4.  [`entries` and Entry Object](#4-entries-and-entry-object)
5.  [Primary Field Definitions](#5-primary-field-definitions)
6.  [Segmentation Rules](#6-segmentation-rules)
7.  [Extension Policy](#7-extension-policy)
8.  [Digital Signatures](#8-digital-signatures)
9.  [Validation](#9-validation)
10. [Complete JSON Example](#10-complete-json-example)
11. [Migration from v1.1.0](#11-migration-from-v110)
12. [Changelog](#12-changelog)

---

## 1. Overview and Design Philosophy

**NALT Protocol** is an open JSON specification for structuring and preserving essential personal information—such as personality, values, thoughts, and behavioral patterns—from all data generated by individuals in an AI-interpretable format.

This specification aims to accurately capture, reproduce, and extend "what makes someone who they are" in future advanced AI environments. Its design is based on four core principles:

* **Reproducibility**: Provides deterministic rules and controlled vocabularies to ensure data is interpreted consistently across different environments.
* **Contextuality**: Views events and thoughts not as isolated "points" but as graphs connected by "lines" with causal relationships and associations, preserving context.
* **Extensibility**: Provides mechanisms to safely extend the specification while maintaining backward compatibility for future needs.
* **Privacy**: Recommends structures that separate personally identifiable information from content itself, respecting data owner control.

## 2. Basic Structure and Top-Level Object

* Files MUST use **UTF-8** encoding.
* File extension is `.json`.
* Root element is a single JSON object.

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `spec_version` | string | ✔︎ | Specification name and semantic version combined. Example: `"nalt-protocol/1.1.1"` |
| `document_id` | string | ✔︎ | A globally unique ID (UUIDv4) for this JSON document. |
| `date` | string | ✔︎ | The date entries belong to (`YYYY-MM-DD` format). |
| `meta` | object | ✔︎ | Stores processing context and metadata for the entire document. |
| `entries` | array | ✔︎ | An array containing one or more Entry objects. |
| `signature` | object | Optional | Digital signature for data integrity verification. |

### Breaking Changes from v1.0.0
- `document_id` is now **required** (was recommended in v1.0.0)

## 3. `meta` Object

Defines the context for the entire document.

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `language` | string | ✔︎ | Default language for the document. Specified as ISO 639-1 code. Example: `"en"` |
| `timezone` | string | ✔︎ | Specified as IANA timezone database name. Example: `"America/New_York"` |
| `x_utc_offset_minutes` | integer | Optional | UTC offset in minutes for performance optimization. Example: `-300` for EST |
| `x_*` | any | Optional | Free extension data with `x_` prefix such as AI logs. |

### New in v1.1.0
- `x_utc_offset_minutes` field for faster timezone calculations

### Changes in v1.1.1
- Removed top-level `timestamp` field (use entry-level `created_at` instead)

## 4. `entries` and Entry Object

Represents each fragment (events, tasks, thoughts, etc.) of the diary.

**4.1 Core Fields**

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `entry_id` | string | ✔︎ | Unique ID for each Entry (UUIDv4 recommended). Serves as a key when referenced by other Entries. |
| `type` | string | ✔︎ | The type of content this Entry represents. Allowed values defined in [Section 5.1](#51-type-allowed-values). |
| `mode` | string | ✔︎ | Time of day when the event occurred (not when recorded). Allowed values defined in [Section 5.2](#52-mode-allowed-values-and-time-periods). |
| `content_format` | string | ✔︎ | Format of the `content` field. Allowed values defined in [Section 5.4](#54-content_format-allowed-values). |
| `content` | string | ✔︎ | Original text data entered by the user. |

### Breaking Changes from v1.0.0
- `content_format` now restricted to standard MIME types (see Section 5.4)

### Changes in v1.1.1
- `mode` now explicitly represents when the event occurred, not when recorded

**4.2 Recommended Fields**

| Field Name | Type | Description |
| :--- | :--- | :--- |
| `summary` | string | AI-generated concise summary of `content` (140 characters or less recommended). |
| `moods` | array | Array of one or more `{ "type": string, "intensity": number }` objects. `type` must be one of 20 predefined values (see Section 5.5). `intensity` ranges from 0.0 to 1.0 with 0.01 precision. |
| `tags` | array | Array of 1 to 6 `snake_case` string tags. |
| `entities` | object | Proper nouns extracted from text. Standard keys include `people`, `locations`, `organizations`, `products`, `media`, but any additional entity types can be added as needed. **Recommend omitting this field entirely when there are no applicable entities.** |
| `end_date` | string | End date for entries spanning multiple days (`YYYY-MM-DD` format). |

### New in v1.1.0
- `end_date` field for multi-day entries (e.g., vacations, projects)
- `intensity` values now support 0.01 precision (was unspecified in v1.0.0)

**4.3 Optional Fields**

| Field Name | Type | Description |
| :--- | :--- | :--- |
| `created_at` | string | Timestamp when the entry was created (ISO 8601 format). See [Section 5.6](#56-entry-creation-timestamp-created_at). |

### New in v1.1.1
- `created_at` field added as optional field to track when entries were recorded

**4.4 Optional Extension Fields (`x_` prefix)**

| Field Name | Type | Description |
| :--- | :--- | :--- |
| `x_relations` | array | Array of `{ "type": string, "target_id": string }` showing relationships to other Entries. Allowed values for `type` defined in [Section 5.3](#53-x_relationstype-allowed-values). |
| `x_due_date` | string | Due date for `task` type Entries (`YYYY-MM-DD` format). |
| `x_*` | any | Other freely definable extension data. |

## 5. Primary Field Definitions

**5.1 `type` Allowed Values**

| Value | Description |
| :--- | :--- |
| `event` | Concrete occurrences or actions that happened in the real world or were experienced by the user. |
| `reflection` | Introspection, contemplation, impressions, self-analysis, and other subjective thoughts or emotions of the user. |
| `task` | Concrete tasks to be executed such as to-do lists or reminders. |
| `idea` | Ideas, inspirations, creative concepts. |
| `log` | Monotonous records of specific data such as meals, sleep, reading. |

**5.2 `mode` Allowed Values and Time Periods**

The `mode` field indicates the time period when the event or situation described in the entry occurred. It does not necessarily match the time when the entry was recorded (`created_at`).

The following five fixed values are used:

| Value | Local Time Range | Description |
| :--- | :--- | :--- |
| `morning` | 05:00 – 11:59 | Morning events |
| `afternoon` | 12:00 – 17:59 | Afternoon events |
| `evening` | 18:00 – 21:59 | Evening events |
| `night` | 22:00 – 04:59 | Night events |
| `none` | - | When time period cannot be determined or for all-day events |

- `mode` is required for each entry.
- The timezone specified in `meta.timezone` is used for local time.

**5.3 `x_relations.type` Allowed Values**

| Value | Description |
| :--- | :--- |
| `caused_by` | Indicates this Entry was caused by the Entry with `target_id` (cause). |
| `led_to` | Indicates this Entry led to the Entry with `target_id` (result). |
| `related_to` | Indicates theme or content is related to the Entry with `target_id` (relation). |
| `explains` | Indicates this Entry elaborates or supplements the Entry with `target_id`. |
| `contradicts` | Indicates this Entry contradicts the Entry with `target_id`. |

**5.4 `content_format` Allowed Values**

| Value | Description |
| :--- | :--- |
| `text/plain` | Plain text without formatting |
| `text/markdown` | Markdown-formatted text |
| `text/html` | HTML-formatted text |
| `application/json` | JSON structured data |
| `text/org` | Org-mode formatted text |

### Breaking Changes from v1.0.0
- Must use standard MIME types (e.g., `text/plain` instead of `plain_text`)
- Limited to the five types listed above

**5.5 `moods.type` Allowed Values**

Mood types are categorized into positive, negative, and neutral emotions:

**Positive moods:**

| Value | Description |
| :--- | :--- |
| `happy` | Joy from experiences or interactions |
| `excited` | Strong anticipation or enthusiasm |
| `peaceful` | Inner tranquility, calm, conflict-free state |
| `content` | Satisfaction, fulfillment without additional needs |
| `grateful` | Thankfulness for kindness or benefits received |
| `calm` | Steady, composed, free of agitation |
| `hopeful` | Expectation and trust in positive future outcomes |
| `proud` | Satisfaction from achievements by oneself or others |
| `motivated` | Determination or eagerness toward future actions |

**Negative moods:**

| Value | Description |
| :--- | :--- |
| `sad` | Sense of loss, disappointment, melancholy |
| `angry` | Irritation or anger toward unfairness or interference |
| `anxious` | Worry, nervousness about future uncertainty |
| `frustrated` | Irritation from obstacles to goals or desires |
| `tired` | Physical or mental fatigue |
| `confused` | Uncertainty, disorientation in unclear situations |
| `lonely` | Feeling isolated or disconnected from others |

**Neutral moods:**

| Value | Description |
| :--- | :--- |
| `neutral` | Regular, emotionally unbiased state |
| `curious` | Eager to know or understand more |
| `nostalgic` | Sentimental or reflective emotions about the past |
| `surprised` | Unexpected reaction to unforeseen events or outcomes |

**5.6 Entry Creation Timestamp (`created_at`)**

The `created_at` field is an optional field for recording the exact date and time when the entry was created in ISO 8601 format. Use only when easily obtainable by the application. Not required.

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `created_at` | string | Optional | The timestamp when the entry was recorded (ISO 8601 format). Example: `"2025-07-10T15:30:00Z"` |

**5.7 Entities Field - Flexible Entity Types**

The `entities` field allows for flexible categorization of proper nouns and named entities. While the schema defines standard entity types, you can add any additional entity types as needed.

**Standard Entity Types:**
- `people`: Names of individuals
- `locations`: Places, cities, countries, addresses
- `organizations`: Companies, institutions, groups
- `products`: Product names, brands, services
- `media`: Books, movies, songs, artworks

**Custom Entity Types:**
You can freely add new entity types beyond the standard ones. Examples:
- `hashtags`: Social media hashtags
- `events`: Conference names, festivals
- `technologies`: Programming languages, frameworks
- `concepts`: Abstract ideas, theories
- Any other category relevant to your use case

**Example:**
```json
{
  "entities": {
    "people": ["Alice", "Bob"],
    "locations": ["Tokyo", "Shibuya"],
    "products": ["iPhone", "MacBook"],
    "hashtags": ["#productivity", "#dailylog"],
    "technologies": ["React", "Node.js"]
  }
}
```

## 6. Segmentation Rules

To maintain consistency in implementation, the following entry segmentation rules are strongly recommended:

1.  **Time Period Change**: Segment when `mode` changes.
2.  **Clear Topic Change**: Segment when the topic changes significantly.
3.  **`type` Change**: Segment when the role of the entry changes, such as switching from `event` to `reflection`.
4.  **Character Count**: Consider segmentation when an entry's `content` exceeds approximately 400 characters in Japanese or 240 tokens in English.

## 7. Extension Policy

### 7.1 Core Extension Rules

1.  **Unknown Field Handling**: Parsers MUST ignore any fields not defined in the official schema.
2.  **Extension Field Naming**: All custom/extension fields MUST be prefixed with `x_` to distinguish them from official fields.
3.  **Schema Flexibility**: The official JSON Schema maintains `additionalProperties: true` at all object levels to allow flexible extensions.

### 7.2 Extension Field Guidelines

- Extension fields can be added at any object level (document, meta, entry)
- Extension field names MUST follow the pattern: `x_[lowercase_snake_case]`
- Examples of valid extension fields:
  - `x_ai_metadata`
  - `x_custom_category`
  - `x_processing_hints`

### 7.3 Implementation Requirements

- Validators MUST NOT fail when encountering unknown fields
- Parsers MUST preserve extension fields during read/write operations
- Applications SHOULD document their custom extension fields for interoperability

## 8. Digital Signatures

v1.1.0 introduces optional digital signatures for data integrity and authenticity verification.

### Signature Object Structure

| Field Name | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `alg` | string | ✔︎ | Signature algorithm. Allowed values: `EdDSA`, `ES256`, `RS256` |
| `sig` | string | ✔︎ | Base64URL encoded signature |
| `public_key` | string | ✔︎ | Public key identifier (e.g., DID format: `did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK`) |

### Signature Creation Process

1. Remove the `signature` field from the document
2. Canonicalize the JSON (RFC 8785)
3. Create signature using the specified algorithm
4. Add the signature object to the document

## 9. Validation

* **Official Schema**: `https://nalt-protocol.org/schemas/v1.1.1/schema.json`
* **Validation Command Example**: `jsonschema -i [your-file.json] https://nalt-protocol.org/schemas/v1.1.1/schema.json`

## 10. Complete JSON Example

```json
{
  "spec_version": "nalt-protocol/1.1.1",
  "document_id": "550e8400-e29b-41d4-a716-446655440000",
  "date": "2025-07-10",
  "meta": {
    "language": "en",
    "timezone": "America/New_York",
    "x_utc_offset_minutes": -240
  },
  "entries": [
    {
      "entry_id": "e1f2g3h4-a1b2-4c3d-8e9f-a0b1c2d3e4f5",
      "type": "reflection",
      "mode": "morning",
      "content_format": "text/plain",
      "content": "Today's economics class was complex, but I managed to understand it. I'm a bit worried about next week's report.",
      "summary": "Understood the morning economics class but feeling anxious about next week's report.",
      "moods": [
        { "type": "anxious", "intensity": 0.50 }
      ],
      "tags": ["university", "study", "economics"],
      "created_at": "2025-07-10T13:45:00Z"
    },
    {
      "entry_id": "f5g6h7i8-b2c3-4d4e-9f0a-b1c2d3e4f5g6",
      "type": "task",
      "mode": "morning",
      "content_format": "text/plain",
      "content": "Economics report assignment (due Friday)",
      "summary": "Submit economics report by Friday.",
      "tags": ["task", "deadline"],
      "x_relations": [
        { "type": "caused_by", "target_id": "e1f2g3h4-a1b2-4c3d-8e9f-a0b1c2d3e4f5" }
      ],
      "x_due_date": "2025-07-17"
    },
    {
      "entry_id": "a7b8c9d0-e1f2-4g3h-4i5j-k6l7m8n9o0p1",
      "type": "event",
      "mode": "afternoon",
      "content_format": "text/markdown",
      "content": "Week-long conference in **San Francisco** starting today. Excited to meet industry leaders and learn about latest AI developments.",
      "end_date": "2025-07-17",
      "summary": "Starting week-long AI conference in San Francisco.",
      "moods": [
        { "type": "excited", "intensity": 0.85 },
        { "type": "curious", "intensity": 0.90 }
      ],
      "tags": ["conference", "ai", "networking"],
      "entities": {
        "locations": ["San Francisco"],
        "organizations": ["AI Conference 2025"]
      },
      "created_at": "2025-07-10T08:00:00Z"
    }
  ],
  "signature": {
    "alg": "EdDSA",
    "sig": "MEUCIQCzoS3gGEHrtPrlUd3tFw8WeFVxpVBNqaI5nGhtpbZaKAIgUPvhD3wqjYYKoNWzQ8VUqS9nCEYx6fPQX2xgR8Kf3eo",
    "public_key": "did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK"
  }
}
```

## 11. Migration from v1.1.0

For detailed migration instructions, see [Migration Guide](../docs/migration/v1.1.0_to_v1.1.1.md).

### Key Changes:
1. **Removed `timestamp`**: Top-level `timestamp` field removed. Use entry-level `created_at` when needed.
2. **Mode Clarification**: `mode` now explicitly represents when the event occurred, not when recorded.
3. **New `created_at`**: Optional field in entries to track recording time.

## 12. Changelog

| Version | Date | Changes |
| :--- | :--- | :--- |
| 1.1.1 | 2025-07-21 | Removed top-level `timestamp`, clarified `mode` definition, added optional `created_at` for entries |
| 1.1.0 | 2025-07-10 | Added required `document_id`, MIME type restrictions for `content_format`, `end_date` field, digital signatures, UTC offset, mood intensity precision, mood type enumeration |
| 1.0.0 | 2025-07-09 | Initial Public Release |